<!DOCTYPE html><html lang="zh-CN"><head>    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1">    <meta name="description" content="">    <meta name="author" content="">    <title>角色添加</title>    <link rel="stylesheet" href="/css/content.css" />    <link rel="stylesheet" href="/js/layui/css/layui.css">    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">    <script src="/js/jquery.min.js?v=2.1.4"></script>    <script src="/js/layui/layui.js"></script>    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>    <script type="text/javascript" src="/js/global.js"></script>    <style>        label.error {            color: red;            position: absolute;            top: 32px;            right: 5px;        }        .top_search {            margin-left: 0px        }         .panel-primary{             border-color: #1ab394;         }        a{            text-decoration: none !important;        }    </style></head><body><div class="container-fluid" style="margin-top: 10px">    <div class="panel panel-primary">        <div class="panel-heading" style="background-color: #1ab394;border-color: #1ab394;">            <span class="badge" style=" color: #1ab394;" >角色添加</span>        </div>    </div></div><form id="form_role_add" method="post" class="layui-form">    <div class="container-fluid">        <div class="row" style="margin-bottom:20px">            <div class="col-md-3">                <div class="input-group">                    <div class="input-group-addon">角色名：</div>                    <input name="role_name" type="text" value="{{$roleData['role_name']}}" placeholder="请输入角色名" class="form-control" style="width:300px;" id="role_name">                    <div class="input-group-addon">角色说明：</div>                    <input name="role_declare" type="text"  value="{{$roleData['role_declare']}}" placeholder="请输入角色描述" class="form-control" style="width:500px;" id="role_declare">                </div>            </div>        </div>        <div class="table-responsive">            <table class="table table-bordered table-condensed table-hover">                <thead>                <tr>                    <th>栏目</th>                    <th>栏目权限编辑</th>                </tr>                </thead>                <tbody>                <?php foreach($menus as $item):?>                    <tr>                        <td>                            <input lay-skin="primary" type="checkbox" name="menu_id[]" value="{{$item['id']}}" data-id="{{$item['id']}}"                                   data-pid="{{$item['pid']}}" class="menu" {{checkBoxChecked($item[id],$roleData[menu_id])}} >&nbsp;&nbsp;{{$item['name']}}                        </td>                        <td>                            <?php if(isset($item['son'])):?>                            <?php foreach($item['son'] as $smenu):?>                            <input lay-skin="primary" type="checkbox" name="menu_id[]" value="{{$smenu['id']}}" data-id="{{$smenu['id']}}"                                   data-pid="{{$smenu['pid']}}" class="menu" {{checkBoxChecked($smenu[id], $roleData[menu_id])}} >&nbsp;&nbsp;{{$smenu['name']}}                                <?php //foreach($smenu['method'] as $ssitems):?>                            <!--<volist name="smenu.method" id="ssitems" key="ssKey">-->                                <!--<eq name="ssKey" value="1">                                    <span style="margin-left:30px;" class="glyphicon glyphicon-option-horizontal"></span>                                </eq>                                <input lay-skin="primary" style=" margin-left:10px;" type="checkbox" name="menu_id[]" value="{$ssitems.id}" data-method-id="{$ssitems.id}"                                       data-pid="{$ssitems.pid}" class="method" {:checkBoxChecked($ssitems[id],$roleData[method_id])}>&nbsp;&nbsp;{$ssitems.name}                            <?php //endforeach;?>-->                            <br/>                            <?php endforeach;endif;?>                        </td>                    </tr>                <?php endforeach;?>                </tbody>            </table>        </div>        <div class="row" style="text-align: center">            <div class="col-md-12" style="margin-bottom: 20px;">                <div class="layui-btn" id="sub-btn" action="{{$roleData['id']?'edit':'add'}}" attr="{{$roleData['id']}}" >{{$roleData['id']?'编辑':'添加'}}</div>                <input class="layui-btn layui-btn-primary" type="reset" value="重置">            </div>        </div>    </div></form></body><script>    $(function () {        layui.use(['form'], function(){});        //多选        $(document).on('click', '.layui-form-checkbox', function () {            roleFn.checkSon(                $(this).prev().attr('data-id'),                $(this).hasClass('layui-form-checked') ? true : false            );        });        //添加--编辑        $('#sub-btn').click(function(){            var roleName = $.trim($('#role_name').val());            var roleDeclare = $.trim($('#role_declare').val());            var menuIdStr = '', methodIdStr = '';            if(roleName == ''){                layui.use('layer', function(){                    layui.layer.msg('请输入角色名称');                });                return false;            }            //菜单id            $('.menu').each(function(){                if($(this).next().hasClass('layui-form-checked')){                   menuIdStr += $(this).attr('data-id')+',';                }            });            //方法id            /*$('.method').each(function(){                if($(this).next().hasClass('layui-form-checked')){                    methodIdStr += $(this).attr('data-method-id')+',';                }            });*/            layui.use('layer', function(){                _index = layui.layer.load();            });            $.ajax({                url: "{{route('role.create')}}",                type:"post",     //请求类型                data:{                    '_token':'{{csrf_token()}}',                    id:$('#sub-btn').attr('attr'),                    role_name:roleName,                    roleDeclare:roleDeclare,                    menuIdStr:menuIdStr,                    methodIdStr:methodIdStr,                    action:$('#sub-btn').attr('action')                },  //请求的数据                dataType:"json",  //数据类型                success: function(data){                    data.status == 1 ? globalFn.remind(_index, data.msg,"{{route('role.index')}}")                        : globalFn.remind(_index, data.msg);                },                error: function(msg) {                    var json=JSON.parse(msg.responseText);                    layui.use('layer', function(){                        var layer = layui.layer;                        setTimeout(function () { layer.close(_index); }, 1000);                        setTimeout(function () { layer.msg(json.message) }, 1000);                    });                },            })        });    });    //全局函数    var roleFn = {        //选中所有子级的checkbox        checkSon: function (id, checkState) {            var Scheckboxs = $("input:checkbox[data-pid=" + id + "]");            if (Scheckboxs.size() > 0) {                Scheckboxs.each(function () {                    var id = $(this).attr('data-id');                    checkState ? $(this).next().addClass('layui-form-checked') : $(this).next().removeClass('layui-form-checked');                    roleFn.checkSon(id, checkState);                });            }        },    }</script></html>